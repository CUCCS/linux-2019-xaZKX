# 动手实战SYSTEMD

## 实验要求

- [x] 完成[Systemd 入门教程：命令篇 by 阮一峰的网络日志](http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html)和[Systemd 入门教程：实战篇 by 阮一峰的网络日志](http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html)完整实验过程。
- [x] 实验过程通过asciinema进行录像并上传。
- [x] 完成课后自查清单。

## 实验环境

- Ubuntu 18.04.1 server

## 实验过程

### 1. 命令篇

#### 系统管理

- **systemctl**

  ```bash
  # 重启系统
  $ sudo systemctl reboot
  
  # 关闭系统，切断电源
  $ sudo systemctl poweroff
  
  # CPU停止工作
  $ sudo systemctl halt
  
  # 暂停系统
  $ sudo systemctl suspend
  
  # 让系统进入冬眠状态
  $ sudo systemctl hibernate
  
  # 让系统进入交互式休眠状态
  $ sudo systemctl hybrid-sleep
  
  # 启动进入救援状态（单用户状态）
  $ sudo systemctl rescue
  
  [![](https://asciinema.org/a/236694.svg)](https://asciinema.org/a/236694)
  ```

  [![](https://asciinema.org/a/236267.svg)](https://asciinema.org/a/236267)

#### Unit

[![](https://asciinema.org/a/236289.svg)](https://asciinema.org/a/236289)

#### Unit 的配置文件

[![](https://asciinema.org/a/236287.svg)](https://asciinema.org/a/236287)

#### Target

[![](https://asciinema.org/a/236292.svg)](https://asciinema.org/a/236292)

#### 日志管理

[![](https://asciinema.org/a/236294.svg)](https://asciinema.org/a/236294)

### 2. 实战篇

[![](https://asciinema.org/a/236301.svg)](https://asciinema.org/a/236301)



## 自查清单

- **如何添加一个用户并使其具备sudo执行程序的权限？**

  ```bash
  # 进入root用户模式
  sudo su - 
  
  # 添加一个sec用户
  adduser sec 
  
  # 将sec用户加到sudo组里面
  sudo usermod -a -G sudo sec
  ```

  [![](https://asciinema.org/a/236694.svg)](https://asciinema.org/a/236694)

- **如何将一个用户添加到一个用户组？**

  ```bash
  # 将已有用户添加到一个已有用户组。
  sudo usermod -a -G usergroup username
  
  # 新增用户并将该用户添加到已有用户组
  useradd -G usergroup username
  ```

- **如何查看当前系统的分区表和文件系统详细信息？**

  - 查看分区表：`sudo fdisk -l`
  - 查看文件系统信息：`df -a(/-l)`

  

- **如何实现开机自动挂载Virtualbox的共享目录分区？**

  - 用VirtualBox虚拟机的共享文件夹设置共享的本地文件。(本地文件夹「Ubuntu_share」)

  - 在虚拟机上创建一个共享目录  `mkdir /mnt/share`

  -  实现挂载`mount -t vboxsf Ubuntu_share /mnt/share`
  - 开机自启动：在` /etc/rc.local`文件中追加`mount -t vboxsf Ubuntu_share /mnt/share`

- **基于LVM（逻辑分卷管理）的分区如何实现动态扩容和缩减容量？**

  ```bash
  # 逻辑卷信息
  lvdisplay
  
  # 缩容(减小1G)(不带-号是减小至)
  lvreduce -L -1G /dev/cuc-vg/root
  
  # 扩容(增加2G)(不带+号是增加至)
  lvextend -L +2G /dev/cuc-vg/root
  
  # 更改大小
  lvresize --size +1G /dev/cuc-vg/root
  ```

- **如何通过systemd设置实现在网络连通时运行一个指定脚本，在网络断开时运行另一个脚本？**

  - 将NetworkManager.service配置文件的Service区块的ExecStartPost和ExecStopPost两个字段进行修改

    ```bash
    ExecStartPost = xxx  #网络连通时运行的指定脚本
    ExecStopPost = xxx   #网络断开时运行的脚本
    ```

- **如何通过systemd设置实现一个脚本在任何情况下被杀死之后会立即重新启动？实现杀不死？**

  ```bash
  # 实现杀不死，就在[Service]中添加「Restart=always」。
  
  # 重新加载配置文件
  systemctl daemon-reload
  
  # 启动该服务
  systemctl start xxx.service
  ```

## 参考

1. [Systemd 入门教程：命令篇](http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html)
2. [Systemd 入门教程：实战篇](http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html)
3. [VirtualBox 共享文件夹设置](https://blog.csdn.net/ysh198554/article/details/73335844)

4. [https://github.com/CUCCS/linux-2019-FLYFLY-H](https://github.com/CUCCS/linux-2019-FLYFLY-H/blob/linux_exp3/实验报告三.md)

